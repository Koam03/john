<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dynamic Asset Gallery</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }
        .gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px;
            justify-content: center;
        }
        .gallery-item {
            flex: 1 0 21%; /* Adjust as needed for responsiveness */
            box-sizing: border-box;
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            position: relative;
        }
        .gallery-item img,
        .gallery-item video,
        .gallery-item audio,
        .gallery-item iframe {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 3px;
        }
        .placeholder {
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background-color: #ccc;
            position: relative;
            border-radius: 3px;
        }
        .placeholder::after {
            content: attr(data-alt);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #666;
            font-size: 1em;
            text-align: center;
        }
        @media (max-width: 1200px) {
            .gallery-item {
                flex: 1 0 28%;
            }
        }
        @media (max-width: 800px) {
            .gallery-item {
                flex: 1 0 45%;
            }
        }
        @media (max-width: 500px) {
            .gallery-item {
                flex: 1 0 90%;
            }
        }
    </style>
</head>
<body>
    <h1 style="text-align:center; padding-top:20px;">Dynamic Asset Gallery</h1>
    <div class="gallery"></div>

    <script>
        const gallery = document.querySelector('.gallery');

        // Define supported asset types with their possible extensions
        const assetTypes = {
            image: ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'ai', 'svg'],
            video: ['mp4', 'webm', 'ogg', 'mov'],
            audio: ['mp3', 'wav', 'aac'],
            document: ['pdf', 'doc', 'docx', 'txt'],
            // Add more asset types and their extensions as needed
        };

        /**
         * Capitalizes the first letter of a string.
         * @param {string} string - The string to capitalize.
         * @returns {string} - The capitalized string.
         */
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        /**
         * Determines the asset type based on its file extension.
         * @param {string} filename - The name of the file.
         * @returns {string|null} - The asset type or null if unsupported.
         */
        function getAssetType(filename) {
            const extension = filename.split('.').pop().toLowerCase();
            for (const [type, extensions] of Object.entries(assetTypes)) {
                if (extensions.includes(extension)) {
                    return type;
                }
            }
            return null;
        }

        /**
         * Creates and appends an asset element to the gallery.
         * @param {string} filename - The name of the asset file.
         */
        function addAsset(filename) {
            const assetType = getAssetType(filename);
            if (!assetType) {
                console.warn(`Unsupported asset type for file: ${filename}`);
                return;
            }

            const div = document.createElement('div');
            div.classList.add('gallery-item');

            let element;

            switch (assetType) {
                case 'image':
                    element = document.createElement('img');
                    element.alt = filename;
                    element.loading = 'lazy'; // Improve performance with lazy loading
                    break;
                case 'video':
                    element = document.createElement('video');
                    element.controls = true;
                    element.preload = 'metadata';
                    break;
                case 'audio':
                    element = document.createElement('audio');
                    element.controls = true;
                    element.preload = 'metadata';
                    break;
                case 'document':
                    element = document.createElement('iframe');
                    element.title = filename;
                    element.loading = 'lazy';
                    break;
                // Add more cases for additional asset types
                default:
                    console.error(`Unsupported asset type: ${assetType}`);
                    return;
            }

            // Set the source based on the asset type
            if (assetType === 'image' || assetType === 'document') {
                element.src = `Images/${filename}`;
            } else {
                element.src = `Images/${filename}`;
            }

            // Handle loading errors by displaying a placeholder
            element.onerror = () => {
                const placeholder = document.createElement('div');
                placeholder.classList.add('placeholder');
                placeholder.setAttribute('data-alt', `${capitalizeFirstLetter(assetType)} "${filename}" not found`);
                div.replaceChild(placeholder, element);
            };

            // Append the element to the gallery
            div.appendChild(element);
            gallery.appendChild(div);
        }

        /**
         * Fetches the list of asset files from the server and adds them to the gallery.
         */
        function loadAssets() {
            fetch('/api/assets')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(files => {
                    files.forEach(addAsset);
                })
                .catch(error => {
                    console.error('Error fetching asset files:', error);
                    // Optionally, display an error message to the user
                    const errorMsg = document.createElement('p');
                    errorMsg.textContent = 'Failed to load assets. Please try again later.';
                    errorMsg.style.color = 'red';
                    errorMsg.style.textAlign = 'center';
                    gallery.appendChild(errorMsg);
                });
        }

        // Initialize the gallery by loading assets
        loadAssets();
    </script>
</body>
</html>
